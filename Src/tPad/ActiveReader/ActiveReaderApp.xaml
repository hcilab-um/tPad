<UserControl x:Class="UofM.HCI.tPab.App.ActiveReader.ActiveReaderApp" x:Name="arApp"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:src="clr-namespace:UofM.HCI.tPab;assembly=tPadLib"
             xmlns:converters="clr-namespace:UofM.HCI.tPab.App.ActiveReader.Converters"
             xmlns:convertersLib="clr-namespace:UofM.HCI.tPab.Converters;assembly=tPadLib"
             mc:Ignorable="d" d:DesignHeight="300" d:DesignWidth="300" Loaded="arApp_Loaded">
  
  <UserControl.Resources>
    <converters:LayerScalingConverter x:Key="cLayerScaling" />
    <convertersLib:MultiplierConverter x:Key="cMultiplier" />
  </UserControl.Resources>

  <Grid x:Name="gOuterWrapper">
    <Grid.Width>
      <MultiBinding Converter="{StaticResource ResourceKey=cLayerScaling}" FallbackValue="500">
        <Binding ElementName="arApp" Path="Profile.DocumentSize.Width"/>
        <Binding ElementName="arApp" Path="Container.WidthFactor"/>
      </MultiBinding>
    </Grid.Width>
    <Grid.Height>
      <MultiBinding Converter="{StaticResource ResourceKey=cLayerScaling}" FallbackValue="600">
        <Binding ElementName="arApp" Path="Profile.DocumentSize.Height"/>
        <Binding ElementName="arApp" Path="Container.HeightFactor"/>
      </MultiBinding>
    </Grid.Height>

    <Grid x:Name="gCanvas" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Background="Red" Opacity="0.3">
      <!--<Grid.Background>
        <RadialGradientBrush GradientOrigin="0.5,0.5" Center="0.5,0.5" >
          <RadialGradientBrush.GradientStops>
            <GradientStop Color="Blue" Offset="0" />
            <GradientStop Color="Red" Offset="1" />
          </RadialGradientBrush.GradientStops>
        </RadialGradientBrush>
      </Grid.Background>-->
      <Grid.RenderTransform>
        <TransformGroup>
          <RotateTransform Angle="{Binding ElementName=arApp, Path=Device.Location.RotationAngle, Converter={StaticResource ResourceKey=cMultiplier}, ConverterParameter=-1, FallbackValue=0}"
                           CenterX="{Binding ElementName=gOuterWrapper, Path=ActualWidth, Converter={StaticResource ResourceKey=cMultiplier}, ConverterParameter=0.5}"
                           CenterY="{Binding ElementName=gOuterWrapper, Path=ActualHeight, Converter={StaticResource ResourceKey=cMultiplier}, ConverterParameter=0.5}"/>
          <TranslateTransform X="{Binding ElementName=arApp, Path=Device.Location.LocationPx.X, Converter={StaticResource ResourceKey=cMultiplier}, ConverterParameter=-1, FallbackValue=0}" 
                              Y="{Binding ElementName=arApp, Path=Device.Location.LocationPx.Y, Converter={StaticResource ResourceKey=cMultiplier}, ConverterParameter=-1, FallbackValue=0}"/>
        </TransformGroup>
      </Grid.RenderTransform>
    </Grid>
  </Grid>
</UserControl>
